<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta property="og:title" content="Batrina Store Product">
    <meta property="og:description" content="Check out this amazing product on Batrina App!">
    <meta property="og:image" content="https://via.placeholder.com/1200x630?text=Batrina+Store">

    <title>Batrina Store | Product Details</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- 1. Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª --- */
        :root {
            --primary: #000000;
            --accent: #007AFF;
            --bg: #f4f6f9;
            --text: #1a1a1a;
            --text-light: #666;
            --danger: #e53935;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* --- 2. Ø§Ù„ÙƒØ§Ø±Øª --- */
        .card {
            background: white;
            padding: 40px 30px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08), 0 5px 15px rgba(0,0,0,0.02);
            text-align: center;
            max-width: 420px;
            width: 100%;
            position: relative;
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* --- Ø§Ù„Ù„ÙˆØ¬Ùˆ --- */
        .logo { font-size: 28px; font-weight: 800; margin-bottom: 20px; letter-spacing: -0.5px; }
        .logo span { color: var(--accent); }

        /* --- Ø§Ù„Ù„ÙˆØ¯ÙŠÙ†Ø¬ --- */
        .loader-container { display: flex; justify-content: center; margin: 40px 0; }
        .loader {
            width: 40px; height: 40px;
            border: 3px solid #f3f3f3; border-top: 3px solid var(--primary);
            border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ --- */
        #product-content { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .image-wrapper {
            position: relative; width: 100%; height: 320px; margin-bottom: 20px;
            border-radius: 20px; background-color: #f8f9fa; overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
        }
        .product-image { width: 100%; height: 100%; object-fit: cover; }

        .category-badge {
            background: #f0f7ff; color: var(--accent);
            padding: 6px 14px; border-radius: 20px;
            font-size: 11px; font-weight: 600;
            display: inline-block; margin-bottom: 10px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        h2 { font-size: 20px; margin-bottom: 8px; line-height: 1.4; color: var(--text); }

        /* --- Ø§Ù„Ø³Ø¹Ø± --- */
        .price-container { margin: 15px 0; font-size: 22px; font-weight: 700; }
        .old-price { text-decoration: line-through; color: #aaa; font-size: 16px; margin-right: 8px; font-weight: 500; }
        .current-price { color: var(--text); }
        .discount-badge {
            background: #ffebee; color: var(--danger); font-size: 12px; padding: 4px 8px;
            border-radius: 6px; vertical-align: middle; margin-left: 8px;
        }

        /* --- Ø²Ø±Ø§Ø± ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ --- */
        .open-app-btn {
            background: linear-gradient(135deg, #007AFF, #0056b3);
            color: white;
            width: 100%; padding: 16px; border: none; border-radius: 16px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            margin: 25px 0 15px; display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 8px 20px rgba(0,122,255, 0.2); transition: transform 0.2s;
            font-family: 'Poppins', sans-serif;
        }
        .open-app-btn:active { transform: scale(0.98); }

        /* --- Ø²Ø±Ø§ÙŠØ± Ø§Ù„Ø³ØªÙˆØ± --- */
        .store-links { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .store-btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            padding: 12px; border-radius: 12px; text-decoration: none;
            font-weight: 600; font-size: 14px; color: white; transition: opacity 0.2s;
        }
        .store-btn:hover { opacity: 0.9; }
        .btn-google { background: #333; }
        .btn-apple { background: #007AFF; }

        .cta-subtext { font-size: 13px; color: #888; margin-bottom: 20px; }
        .error-msg { color: var(--danger); font-weight: 600; display: none; margin: 20px 0; }
        .footer { margin-top: 30px; font-size: 12px; color: #ccc; }

        svg { width: 20px; height: 20px; fill: currentColor; }
    </style>
</head>
<body>

<div class="card">
    <div class="logo">Batrina<span>.</span></div>

    <div id="loading-spinner" class="loader-container"><div class="loader"></div></div>
    <div id="error-message" class="error-msg">Product not found</div>

    <div id="product-content">

        <div class="image-wrapper">
            <img id="p-image" class="product-image" alt="Product Image" onerror="this.src='https://via.placeholder.com/400x400/f0f0f0/cccccc?text=No+Image'">
        </div>

        <div id="cat-container" style="display:none;">
            <span id="p-category" class="category-badge"></span>
        </div>

        <h2 id="p-name"></h2>
        <div id="p-price" class="price-container"></div>

        <button id="open-in-app-btn" class="open-app-btn">
            <svg viewBox="0 0 24 24" style="fill:white"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M13,17H11V15H13M13,13H11V7H13" /></svg>
            Open in App
        </button>

        <p class="cta-subtext">Don't have the app? Download below.</p>

        <div class="store-links">
            <a href="https://play.google.com/store/apps/details?id=com.oamao.batrina.batrina" class="store-btn btn-google">
                <svg viewBox="0 0 24 24"><path d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.36,13.08L18.6,14.09L15.38,10.88L18.6,7.66L20.36,8.68C20.85,8.95 21.16,9.47 21.16,10.03C21.16,10.65 20.79,11.18 20.24,11.45M16.81,8.63L14.54,10.88L6.05,2.39L16.81,8.63M4.94,1.25L12.43,8.74L12.43,8.74L4.94,16.23V1.25Z" /></svg>
                Get it on Google Play
            </a>
        </div>
    </div>

    <div class="footer">Â© 2025 Batrina Inc.</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD....", // ğŸ”´ ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        authDomain: "batrina-76502.firebaseapp.com",
        projectId: "batrina-76502",
        storageBucket: "batrina-76502.appspot.com",
        messagingSenderId: "...",
        appId: "..."
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function fetchProduct() {
        let productId = null;
        const urlParams = new URLSearchParams(window.location.search);

        // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù€ ID (Ø³ÙˆØ§Ø¡ Ø¨Ù€ ?id= Ø£Ùˆ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±)
        if (urlParams.has('id')) {
            productId = urlParams.get('id');
        } else {
            const pathSegments = window.location.pathname.split('/');
            productId = pathSegments.filter(s => s.length > 0).pop();
        }

        if (!productId || productId === 'product' || productId === 'index.html') {
            showError("Product ID missing");
            return;
        }

        try {
            // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø§ØªØ§ Ù…Ù† ÙØ§ÙŠØ±Ø³ØªÙˆØ±
            const docRef = doc(db, "products", productId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();

                // ğŸš€ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø·Ù„Ø¨ØªÙ‡
                setupOpenAppButton(productId);

                // --- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„Ø°ÙƒÙŠØ©) ---
                let imageUrl = data.thumbnail;
                // Ù„Ùˆ Ø§Ù„Ø«Ø§Ù…Ø¨Ù†ÙŠÙ„ ÙØ§Ø¶ÙŠØŒ Ù‡Ø§Øª Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù„ÙŠØ³ØªØ©
                if ((!imageUrl || imageUrl.trim() === "") && data.images && data.images.length > 0) {
                    imageUrl = data.images[0];
                }

                const imgEl = document.getElementById('p-image');

                if (!imageUrl) {
                    // Ù…Ø§ ÙÙŠØ´ ØµÙˆØ±Ø© Ø®Ø§Ù„Øµ
                    imgEl.src = 'https://via.placeholder.com/400x400/f0f0f0/cccccc?text=No+Preview';
                } else if (imageUrl.startsWith('http')) {
                    // ğŸ¯ HTTP URL
                    imgEl.src = imageUrl;
                } else if (imageUrl.startsWith('/')) {
                    // ğŸ¯ Base64 Ø¨ÙŠØ¨Ø¯Ø£ Ø¨Ù€ / Ø£Ùˆ Ø¨Ù€ iVBO... Ø£Ùˆ /9j/
                    imgEl.src = `data:image/jpeg;base64,${imageUrl}`;
                } else if (imageUrl.startsWith('data:')) {
                    // ğŸ¯ Ø¨Ø§Ù„ÙØ¹Ù„ data URL
                    imgEl.src = imageUrl;
                } else {
                    // âŒ ØµÙŠØºØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
                    imgEl.src = 'https://via.placeholder.com/400x400/f0f0f0/cccccc?text=No+Preview';
                }

                // ğŸš€ ØªØ­Ø¯ÙŠØ« og:image Ù„Ù„Ø´ÙŠØ± (Ø³ÙˆØ§Ø¡ URL Ø£Ùˆ base64)
                if (imageUrl) {
                    let ogImage = document.querySelector('meta[property="og:image"]');
                    if (!ogImage) {
                        ogImage = document.createElement('meta');
                        ogImage.setAttribute('property', 'og:image');
                        document.head.appendChild(ogImage);
                    }
                    ogImage.setAttribute('content', imageUrl);

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ description ÙƒÙ…Ø§Ù†
                    document.querySelector('meta[property="og:description"]').setAttribute(
                        'content',
                        `${data.name} - $${data.salePrice || data.price} on Batrina`
                    );

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ title
                    document.querySelector('meta[property="og:title"]').setAttribute(
                        'content',
                        data.name
                    );
                }

                // --- Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
                document.getElementById('p-name').innerText = data.name || "Unknown Product";

                const cat = data.category || data.categoryName;
                if (cat) {
                    document.getElementById('p-category').innerText = cat;
                    document.getElementById('cat-container').style.display = 'block';
                }

                // --- Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø®ØµÙ… ---
                const priceEl = document.getElementById('p-price');
                if (data.salePrice && data.salePrice < data.price) {
                    const discount = Math.round(((data.price - data.salePrice) / data.price) * 100);
                    priceEl.innerHTML = `
                        <span class="old-price">$${data.price}</span>
                        <span class="current-price">$${data.salePrice}</span>
                        <span class="discount-badge">-${discount}%</span>
                    `;
                } else {
                    priceEl.innerHTML = `<span class="current-price">$${data.price}</span>`;
                }

                document.getElementById('product-content').style.display = 'block';

            } else {
                showError("Product not found or deleted");
            }
        } catch (error) {
            console.error(error);
            showError("Error loading product");
        } finally {
            document.getElementById('loading-spinner').style.display = 'none';
        }
    }

    function showError(msg) {
        document.getElementById('loading-spinner').style.display = 'none';
        const el = document.getElementById('error-message');
        el.innerText = msg;
        el.style.display = 'block';
    }

    // --- ğŸš€ Ø§Ù„Ù…ÙŠØ«ÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø¨ØªØ¹Ù…Ù„ Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù„ÙŠ Ø¥Ù†Øª Ø·Ù„Ø¨ØªÙ‡ ---
    function setupOpenAppButton(id) {
        const btn = document.getElementById('open-in-app-btn');

        btn.onclick = function() {
            // 1. Ø¯Ù‡ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù„ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø³ØªÙ†ÙŠÙ‡
            const path = `product?id=${id}`;

            // 2. Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (Intent URL)
            const intentUrl = `intent://app/${path}#Intent;scheme=batrina;package=com.oamao.batrina.batrina;end`;

            // 3. Ø§ÙØªØ­ Ø§Ù„Ù€ Intent
            window.location.href = intentUrl;
        };
    }

    fetchProduct();
</script>

</body>
</html>